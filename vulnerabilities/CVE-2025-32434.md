# CVE-2025-32434: PyTorch torch.load RCE with weights_only=True

## Quick Reference

| Field | Value |
|-------|-------|
| **CVE ID** | CVE-2025-32434 |
| **Framework** | PyTorch |
| **Affected Versions** | < 2.6.0 |
| **Fixed Version** | 2.6.0 |
| **CVSS Score** | 9.3 (Critical) |
| **CWE** | CWE-502 (Deserialization of Untrusted Data) |
| **Attack Vector** | Network (malicious model file) |
| **Disclosed** | 2025-04-17 |

## Summary

A critical remote code execution vulnerability exists in PyTorch's `torch.load()` function. **Even when using the `weights_only=True` safety flag**, an attacker can craft a malicious model file that executes arbitrary code when loaded. This flag was previously considered the safe way to load untrusted models.

This is particularly dangerous because security guidance prior to this disclosure recommended `weights_only=True` as a mitigation for pickle-based attacks.

## Technical Details

**Vulnerable Function:** `torch.load()` in `torch/serialization.py`

**Root Cause:** The vulnerability exists in the `_legacy_load` function, specifically in the `persistent_load` helper that handles legacy `.tar` format model files. When `weights_only=True` is set, the code uses `_weights_only_unpickler`, but `_legacy_load` did not adequately ensure this unpickler could safely process all contents of a legacy tar file.

**Attack Pattern:**
1. Attacker crafts a malicious `.pt` model file using the legacy tar format
2. Malicious pickle payload is embedded in a way that bypasses the `weights_only` restrictions
3. Victim loads the model with `torch.load("model.pt", weights_only=True)`
4. Despite the "safe" flag, arbitrary code executes with the process's privileges

**Why Previous Guidance Failed:** The `weights_only=True` parameter was intended to restrict deserialization to tensor data only. However, the legacy code path was not fully disabled, allowing specially crafted files to trigger code execution.

## Proof of Concept

Security researcher Ji'an Zhou discovered this vulnerability. Public POCs demonstrate that a malicious tar-format model file can bypass the `weights_only=True` restriction.

```python
# VULNERABLE - even with weights_only=True
import torch
model = torch.load("malicious_model.pt", weights_only=True)  # RCE occurs here
```

## Remediation

### Immediate Actions

1. **Upgrade PyTorch to 2.6.0 or later**
   ```bash
   pip install torch>=2.6.0 --upgrade
   # or
   conda update pytorch -c pytorch
   ```

2. **Audit model sources** - Identify all locations where models are loaded from external/untrusted sources

3. **Use safetensors format** - Migrate to safetensors for model serialization
   ```python
   # Instead of torch.save/torch.load
   from safetensors.torch import save_file, load_file

   # Save
   save_file(model.state_dict(), "model.safetensors")

   # Load
   state_dict = load_file("model.safetensors")
   model.load_state_dict(state_dict)
   ```

### Patch Details

The fix introduces an explicit check within `_legacy_load` to raise an error if attempting to load a legacy tar file with `weights_only=True`, preventing the vulnerable code path from executing.

## GRC Implications

### Risk Assessment

**Risk Level:** Critical

**Impact Scenarios:**
- Any service that loads user-uploaded models is vulnerable
- ML pipelines pulling models from public repositories (Hugging Face Hub) are at risk
- Internal model sharing without validation becomes an attack vector
- Supply chain attacks via poisoned pre-trained models

### Vendor Assessment Questions

When evaluating vendors who use PyTorch:

1. "What version of PyTorch do you use for model loading?"
2. "Do you load models from external sources (Hugging Face Hub, customer uploads, third parties)?"
3. "Were you using `weights_only=True` as a security measure? Have you upgraded since CVE-2025-32434?"
4. "Have you migrated to safetensors format for model serialization?"
5. "How do you validate model file integrity before loading?"

### Control Recommendations

| Control | Description | Priority |
|---------|-------------|----------|
| Version pinning | Require PyTorch >= 2.6.0 in all environments | Critical |
| Format migration | Migrate from .pt/.pkl to .safetensors | High |
| Source validation | Implement allowlists for model sources | High |
| Network segmentation | Isolate model loading services | Medium |
| File scanning | Integrate model file scanning (picklescan) | Medium |

### Policy Updates

Consider updating security policies to include:
- "ML model files (.pt, .pkl, .pth) must not be loaded from untrusted sources without validation"
- "PyTorch deployments must use version 2.6.0 or later"
- "New ML projects should use safetensors format for model serialization"

## References

- [GitHub Advisory GHSA-53q9-r3pm-6pq6](https://github.com/advisories/GHSA-53q9-r3pm-6pq6)
- [PyTorch Security Advisory](https://github.com/pytorch/pytorch/security/advisories/GHSA-53q9-r3pm-6pq6)
- [NVD Entry](https://nvd.nist.gov/vuln/detail/CVE-2025-32434)
- [Kaspersky Analysis](https://www.kaspersky.com/blog/vulnerability-in-pytorch-framework/53311/)
- [AI Security Academy Deep Dive](https://www.aisecurityacademy.ai/blogs/pytorch-torch-load-rce-vulnerability)

## Timeline

| Date | Event |
|------|-------|
| 2025-04-17 | Vulnerability publicly disclosed |
| 2025-04-17 | PyTorch 2.6.0 released with fix |
| 2025-04-17 | GitHub Advisory published |

## Related Vulnerabilities

- [CVE-2024-37059](CVE-2024-37059.md) - MLflow PyTorch model loading
- Historical PyTorch pickle issues (pre-weights_only era)

---

*Last updated: 2026-01-18*

*Tags: `pytorch` `torch.load` `weights_only` `critical` `rce` `model-loading`*
